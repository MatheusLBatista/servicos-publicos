# Plano de Teste para Model `TipoDemanda` (Sprint 5)

| Funcionalidade                          | Comportamento Esperado                                                                                   | Verificações                                                                               | Critérios de Aceite                                                                   |
| --------------------------------------- | -------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------- |
| Criação válida de tipo demanda          | Deve criar um tipo de demanda com todos os campos válidos e opcionais preenchidos corretamente           | Criar tipo demanda com título, descrição, link\_imagem, ícone, subdescrição e tipo válidos | O tipo demanda é salvo e retornado com \_id definido                                  |
| Validação de título obrigatório         | Deve retornar erro ao tentar criar um tipo demanda sem o campo título                                    | Criar tipo demanda sem título                                                              | Deve lançar erro de validação com mensagem "O título da demanda é obrigatório!"       |
| Validação de descrição obrigatória      | Deve retornar erro ao tentar criar um tipo demanda sem a descrição                                       | Criar tipo demanda sem descrição                                                           | Deve lançar erro de validação com mensagem "A descrição da demanda é obrigatória!"    |
| Validação de link\_imagem inválido      | Deve retornar erro ao criar tipo demanda com link\_imagem inválido (não URL válida ou formato incorreto) | Criar tipo demanda com link\_imagem inválido                                               | Deve lançar erro de validação com mensagem específica do erro                         |
| Aceitar link\_imagem vazio ou ausente   | Deve permitir salvar tipo demanda sem link\_imagem ou com link\_imagem vazio                             | Criar tipo demanda com link\_imagem vazia ou omitida                                       | O campo link\_imagem deve ser salvo como string vazia ""                              |
| Validação de ícone inválido             | Deve retornar erro ao criar tipo demanda com ícone inválido (não URL válida ou formato incorreto)        | Criar tipo demanda com ícone inválido                                                      | Deve lançar erro de validação com mensagem específica do erro                         |
| Aceitar ícone vazio ou ausente          | Deve permitir salvar tipo demanda sem ícone ou com ícone vazio                                           | Criar tipo demanda com ícone vazio ou omitido                                              | O campo ícone deve ser salvo como string vazia ""                                     |
| Validação de subdescrição obrigatória   | Deve retornar erro ao tentar criar tipo demanda sem subdescrição                                         | Criar tipo demanda sem subdescrição                                                        | Deve lançar erro de validação com mensagem "A subdescrição da demanda é obrigatória!" |
| Validação de tipo obrigatório           | Deve retornar erro ao tentar criar tipo demanda sem o campo tipo                                         | Criar tipo demanda sem tipo                                                                | Deve lançar erro de validação com mensagem "O tipo da demanda é obrigatório!"         |
| Listagem de tipos de demanda            | Deve listar todos os tipos de demanda cadastrados                                                        | Inserir múltiplos tipos demanda e fazer consulta                                           | A resposta contém todos os tipos cadastrados                                          |
| Atualização de tipo demanda existente   | Deve atualizar os dados de um tipo demanda existente pelo ID                                             | Atualizar o título ou outro campo de tipo demanda existente                                | O registro atualizado reflete as alterações                                           |
| Atualização de tipo demanda inexistente | Deve retornar null ao tentar atualizar tipo demanda com ID inexistente                                   | Atualizar tipo demanda com ID inválido ou inexistente                                      | Deve retornar null                                                                    |
| Remoção de tipo demanda existente       | Deve remover um tipo demanda existente pelo ID                                                           | Deletar um tipo demanda cadastrado pelo ID                                                 | O registro é removido e não pode ser mais encontrado                                  |
| Remoção de tipo demanda inexistente     | Deve retornar null ao tentar deletar tipo demanda com ID inexistente                                     | Deletar tipo demanda com ID inexistente                                                    | Deve retornar null                                                                    |
| Erro ao deletar com ID malformado       | Deve lançar erro ao tentar deletar tipo demanda com ID malformado (ex: string curta ou formato inválido) | Deletar tipo demanda com ID malformado                                                     | Deve lançar erro                                                                      |

---

# Plano de Teste para `TipoDemandaController` (Sprint 5)

| Funcionalidade        | Comportamento Esperado                                                   | Cenários/Testes                                                                                                                             | Critérios de Aceite                                           |
| --------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------- |
| Listar TipoDemandas   | Deve listar os tipos de demanda conforme filtros opcionais               | - Listar com parâmetros válidos<br>- Listar sem parâmetros<br>- Validar ID inválido<br>- Validar queries inválidas (titulo, tipo)           | Resposta 200 com dados esperados ou erro de validação lançado |
| Criar TipoDemanda     | Deve criar nova TipoDemanda com dados válidos                            | - Criar com dados válidos<br>- Lidar com erro no `toObject`<br>- Lidar com erro inesperado no service                                       | Resposta 201 com o recurso criado ou lançamento de erro       |
| Atualizar TipoDemanda | Deve atualizar TipoDemanda existente por ID                              | - Atualizar com dados válidos<br>- Lidar com erro inesperado no service                                                                     | Resposta 200 com dados atualizados ou lançamento de erro      |
| Deletar TipoDemanda   | Deve deletar TipoDemanda existente por ID                                | - Deletar com ID válido<br>- ID não fornecido (CustomError)<br>- ID inválido (erro validação Zod)<br>- Lidar com erro inesperado no service | Resposta 200 com confirmação ou lançamento de erro            |
| Tratamento de erros   | Deve lançar erros adequados nos casos de falhas de validação ou internas | - Lançar erro de validação Zod<br>- Lançar `CustomError` para casos específicos                                                             | Erros esperados com status e mensagens adequadas              |

---

# Plano de Teste para `TipoDemandaService` (Sprint 5)

| Funcionalidade                                       | Comportamento Esperado                                                  | Verificações                                                                                                           | Critérios de Aceite                                                                 |
| ---------------------------------------------------- | ----------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| Listar tipos de demanda                              | Deve retornar lista com todos os tipos de demanda                       | Chamada ao método listar do repository<br>Retorna array com os tipos                                                   | Retorna array esperado<br>Repository listar chamado                                 |
| Criar tipo de demanda com título único e tipo válido | Deve criar novo tipo de demanda se título não existir e tipo for válido | Busca por título inexistente<br>Chama criar do repository com dados válidos<br>Retorna dados criados                   | Tipo criado e retornado<br>BuscarPorTitulo e Criar chamados com parâmetros corretos |
| Criar tipo de demanda com título duplicado           | Deve lançar erro ao tentar criar com título já existente                | BuscarPorTitulo retorna objeto existente<br>Criação é impedida<br>Erro CustomError lançado                             | Erro lançado com mensagem específica (CustomError)                                  |
| Criar tipo de demanda com tipo inválido              | Deve lançar erro se o tipo informado não está na lista válida           | BuscarPorTitulo retorna null<br>Tipo inválido passado<br>Erro CustomError lançado                                      | Erro lançado pelo tipo inválido                                                     |
| Atualizar tipo de demanda existente                  | Deve atualizar tipo existente pelo ID com dados válidos                 | BuscarPorID retorna registro<br>BuscarPorTitulo retorna null ou diferente do próprio ID<br>Atualizar chamado com dados | Retorno com dados atualizados<br>Repository métodos chamados corretamente           |
| Atualizar tipo de demanda inexistente                | Deve lançar erro se tentar atualizar tipo não encontrado                | BuscarPorID retorna null<br>Erro CustomError lançado                                                                   | Erro lançado (CustomError)                                                          |
| Deletar tipo de demanda existente                    | Deve deletar registro existente pelo ID                                 | BuscarPorID retorna registro<br>Chama deletar do repository<br>Retorna resultado da exclusão                           | Registro removido<br>Repository chamado com ID correto                              |
| Deletar tipo de demanda inexistente                  | Deve lançar erro ao tentar deletar tipo não existente                   | BuscarPorID retorna null<br>Erro CustomError lançado                                                                   | Erro lançado (CustomError)                                                          |

---

# Plano de Teste para TipoDemandaRepository (Sprint X)

| Método            | Caso de Teste                         | Comportamento Esperado                                  | Verificações                                             | Critério de Aceite                  |
| ----------------- | ------------------------------------- | ------------------------------------------------------- | -------------------------------------------------------- | ----------------------------------- |
| `buscarPorID`     | Encontrar tipo de demanda por ID      | Retorna o documento correto quando encontrado           | `findOne` chamado com filtro `_id`                       | Retorna tipo de demanda correto     |
|                   | Tipo de demanda não encontrado        | Lança `CustomError` quando não encontra documento       | `findOne` chamado, resultado `null`                      | Lança erro                          |
| `buscarPorTitulo` | Encontrar tipo de demanda pelo título | Retorna tipo de demanda com título específico           | `findOne` chamado com filtro `titulo`                    | Retorna tipo de demanda correto     |
|                   | Ignorar um ID ao buscar por título    | Busca por título ignorando um `_id` específico          | `findOne` chamado com filtro `titulo` e `_id: {$ne: id}` | Retorna tipo de demanda correto     |
| `buscarPorTipo`   | Encontrar tipo de demanda pelo tipo   | Retorna tipo de demanda com tipo específico             | `findOne` chamado com filtro `tipo`                      | Retorna tipo de demanda correto     |
|                   | Ignorar um ID ao buscar por tipo      | Busca por tipo ignorando um `_id` específico            | `findOne` chamado com filtro `tipo` e `_id: {$ne: id}`   | Retorna tipo de demanda correto     |
| `listar`          | Buscar por ID via `req.params.id`     | Retorna tipo de demanda específico pelo id              | `findById` chamado, converte com `toObject()`            | Retorna tipo de demanda correto     |
|                   | Erro ao buscar por ID não encontrado  | Lança `CustomError` se tipo de demanda não encontrado   | `findById` retorna `null`                                | Lança erro                          |
|                   | Listar com paginação e filtros        | Retorna lista paginada de tipos de demandas             | `paginate` chamado com filtros e opções                  | Retorna lista paginada corretamente |
|                   | Listagem vazia                        | Lança erro se não encontrar nenhum tipo de demanda      | `paginate` retorna `docs: []`                            | Lança erro                          |
| `criar`           | Criar novo tipo de demanda            | Salva novo tipo de demanda com dados fornecidos         | Construtor do modelo chamado com dados + `save` chamado  | Retorna tipo de demanda criada      |
| `atualizar`       | Atualizar tipo de demanda existente   | Atualiza tipo de demanda e retorna documento atualizado | `findByIdAndUpdate` chamado com `{ new: true }`          | Retorna tipo de demanda atualizada  |
|                   | Atualizar tipo de demanda inexistente | Lança erro se tipo de demanda não for encontrado        | `findByIdAndUpdate` retorna `null`                       | Lança erro                          |
| `deletar`         | Deletar tipo de demanda               | Deleta tipo de demanda pelo ID                          | `findByIdAndDelete` chamado                              | Retorna tipo de demanda deletada    |

---