# Plano de Teste para Model Secretaria (Sprint 5)

| Funcionalidade                        | Comportamento Esperado                                                                              | Verificações                                                                 | Critérios de Aceite                                                                                           |
| ------------------------------------- | --------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| Cadastro válido                       | Uma secretaria com todos os campos obrigatórios preenchidos corretamente deve ser salva com sucesso | Inserir secretaria com `nome`, `sigla`, `email` e `telefone` válidos         | A secretaria é salva e retornada com `_id`, `createdAt` e `updatedAt`                                         |
| Cadastro sem nome                     | O cadastro deve falhar se o campo `nome` estiver ausente                                            | Tentar salvar secretaria sem o campo `nome`                                  | A operação falha com erro de validação (`ValidationError`) e mensagem `"O nome da secretaria é obrigatório!"` |
| Cadastro sem sigla                    | O cadastro deve falhar se o campo `sigla` estiver ausente                                           | Tentar salvar secretaria sem o campo `sigla`                                 | A operação falha com erro de validação e mensagem `"A sigla da secretaria é obrigatório!"`                    |
| Cadastro sem email                    | O cadastro deve falhar se o campo `email` estiver ausente                                           | Tentar salvar secretaria sem o campo `email`                                 | A operação falha com erro de validação e mensagem `"O email da secretaria é obrigatório!"`                    |
| Cadastro sem telefone                 | O cadastro deve falhar se o campo `telefone` estiver ausente                                        | Tentar salvar secretaria sem o campo `telefone`                              | A operação falha com erro de validação e mensagem `"O telefone da secretaria é obrigatório!"`                 |
| Listagem de secretarias               | O sistema deve retornar todas as secretarias cadastradas                                            | Inserir duas ou mais secretarias e fazer consulta                            | A resposta contém um array com as secretarias cadastradas                                                     |
| Atualização de secretaria             | Deve ser possível atualizar uma secretaria existente                                                | Atualizar um campo (ex: nome) de uma secretaria existente                    | A secretaria reflete os dados alterados, campo atualizado, e `updatedAt` é alterado                           |
| Atualização de secretaria inexistente | A tentativa de atualizar uma secretaria inexistente deve retornar `null`                            | Tentar atualizar secretaria com ID inexistente                               | O resultado da atualização é `null`                                                                           |
| Remoção de secretaria                 | Deve ser possível remover uma secretaria existente                                                  | Deletar uma secretaria existente pelo ID                                     | A secretaria removida não é mais encontrada na base                                                           |
| Remoção de secretaria inexistente     | A tentativa de remover uma secretaria inexistente deve retornar `null`                              | Tentar deletar secretaria com ID inexistente                                 | O resultado da remoção é `null`                                                                               |
| Remoção com ID malformado             | Tentar remover secretaria com ID inválido (mal formatado) deve lançar erro                          | Chamar remoção com ID malformado (ex: string menor que o padrão do ObjectId) | A operação lança um erro (exceção)                                                                            |

---

# Plano de Teste para Controller de Secretaria (Sprint 5)

| Funcionalidade                         | Comportamento Esperado                                                                      | Verificações                                                       | Critérios de Aceite                                                                     |
| -------------------------------------- | ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ | --------------------------------------------------------------------------------------- |
| Listagem de secretarias                | O sistema deve retornar todas as secretarias, sem parâmetros ou com parâmetros válidos      | Chamada ao método `listar` sem parâmetros ou com queries válidas   | Retorna array com secretarias e status 200, mensagem de sucesso                         |
| Listagem por ID válido                 | O sistema deve listar a secretaria específica pelo ID válido                                | Chamada ao método `listar` com `req.params.id` válido              | Retorna secretaria correspondente e status 200                                          |
| Validação de ID inválido               | A tentativa de listar com ID inválido deve lançar erro de validação                         | Chamada ao método `listar` com `req.params.id` inválido            | Erro lançado com mensagem "ID inválido"                                                 |
| Validação de query nome vazia          | O parâmetro `nome` da query não pode ser vazio                                              | Chamada ao método `listar` com `req.query.nome` vazio              | Erro lançado com mensagem "Nome não pode ser vazio"                                     |
| Validação de query tipo vazia          | O parâmetro `tipo` da query não pode ser vazio                                              | Chamada ao método `listar` com `req.query.tipo` vazio              | Erro lançado com mensagem "Tipo não pode ser vazio"                                     |
| Criação de nova secretaria             | O sistema deve criar uma secretaria com dados válidos                                       | Chamada ao método `criar` com body válido                          | Secretaria criada, retornada com status 201 e mensagem de sucesso                       |
| Atualização de secretaria              | O sistema deve atualizar uma secretaria existente com dados válidos                         | Chamada ao método `atualizar` com ID válido e body com novos dados | Secretaria atualizada e retornada, status 200, mensagem de sucesso                      |
| Exclusão de secretaria                 | O sistema deve excluir uma secretaria pelo ID válido                                        | Chamada ao método `deletar` com ID válido                          | Secretaria excluída, retornada com status 200 e mensagem de sucesso                     |
| Validação de ID obrigatório no deletar | O sistema deve lançar erro caso não seja fornecido ID ao deletar                            | Chamada ao método `deletar` sem ID                                 | Lançamento de `CustomError` com status 400 e mensagem informando que o ID é obrigatório |
| Validação de ID inválido no deletar    | O sistema deve lançar erro ao tentar deletar com ID inválido                                | Chamada ao método `deletar` com ID inválido                        | Erro lançado de validação, serviço não chamado                                          |
| Tratamento de erro inesperado          | O sistema deve lidar com erros inesperados do service em listar, criar, atualizar e deletar | Service rejeita promessa com erro inesperado                       | O erro é lançado para ser tratado mais acima (não capturado no controller)              |
| Transformação incorreta no criar       | O sistema deve lidar com erro ao transformar documento no método criar                      | Service retorna objeto que lança erro ao chamar `toObject()`       | O erro é lançado e o fluxo é interrompido                                               |
| Listagem sem validação ID e query      | Quando não houver ID ou query, a listagem deve funcionar normalmente                        | Chamada ao método listar com `req.params` e `req.query` vazios     | Lista todas as secretarias com sucesso                                                  |


---

# Plano de Teste para SecretariaService (Sprint 5)

| Funcionalidade                     | Comportamento Esperado                                         | Verificações                                                                 | Critérios de Aceite                                                            |
| ---------------------------------- | -------------------------------------------------------------- | ---------------------------------------------------------------------------- | ------------------------------------------------------------------------------ |
| Listar secretarias                 | Deve retornar uma lista de secretarias disponíveis             | Chamada ao método `listar` do repositório                                    | Retorna array de secretarias e chama o método do repositório                   |
| Criar secretaria com nome único    | Deve criar uma secretaria se o nome não existir                | Chamada a `buscarPorNome` retorna `null`, chama `criar` com os dados         | Secretaria criada, método `criar` do repositório chamado com os dados corretos |
| Criar secretaria com nome repetido | Deve lançar erro caso o nome da secretaria já exista           | Chamada a `buscarPorNome` retorna uma secretaria existente                   | Lançamento de `CustomError` proibindo duplicação                               |
| Atualizar secretaria existente     | Deve atualizar secretaria se ID existir no banco               | `buscarPorID` retorna secretaria existente, chama `atualizar` com ID e dados | Retorna secretaria atualizada, chama métodos do repositório                    |
| Atualizar secretaria inexistente   | Deve lançar erro ao tentar atualizar secretaria que não existe | `buscarPorID` retorna null                                                   | Lançamento de `CustomError` informando que secretaria não existe               |
| Deletar secretaria existente       | Deve deletar secretaria se ID existir no banco                 | `buscarPorID` retorna secretaria existente, chama `deletar` com ID           | Retorna resultado da exclusão, chama métodos do repositório                    |
| Deletar secretaria inexistente     | Deve lançar erro ao tentar deletar secretaria que não existe   | `buscarPorID` retorna null                                                   | Lançamento de `CustomError` informando que secretaria não existe               |

---

# Plano de Teste para SecretariaRepository (Sprint 5)

| Funcionalidade                     | Comportamento Esperado                                         | Verificações                                                                            | Critérios de Aceite                                                                  |
| ---------------------------------- | -------------------------------------------------------------- | --------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------ |
| buscarPorID                        | Deve encontrar uma secretaria pelo ID                          | Chamada ao método `findOne` com filtro `{ _id: ObjectId }`<br>Retorna objeto secretaria | Retorna secretaria correta<br>`findOne` chamado com o filtro correto                 |
| buscarPorID (não existe)           | Deve lançar erro se secretaria não for encontrada pelo ID      | `findOne` retorna `null`<br>Lançamento de `CustomError`                                 | Erro `CustomError` lançado                                                           |
| buscarPorNome                      | Deve retornar secretaria pelo nome                             | Chamada ao método `findOne` com filtro `{ nome }`<br>Retorna objeto secretaria          | Retorna secretaria correta<br>`findOne` chamado com filtro correto                   |
| buscarPorNome (com id a ignorar)   | Deve ignorar secretaria com determinado ID ao buscar pelo nome | Chamada ao método `findOne` com filtro `{ nome, _id: { $ne: idIgnorado } }`             | Retorna secretaria correta<br>`findOne` chamado com filtro correto                   |
| listar (com params.id)             | Deve retornar secretaria pelo ID via `findById`                | Chamada ao método `findById`<br>Retorna objeto secretaria                               | Retorna secretaria correta<br>`findById` chamado com o ID correto                    |
| listar (com params.id inexistente) | Deve lançar erro 404 se secretaria não encontrada pelo ID      | `findById` retorna `null`<br>Lançamento de `CustomError`                                | Erro `CustomError` lançado                                                           |
| listar (sem params.id)             | Deve listar secretarias com paginação e filtros                | Chamada ao método `paginate` com filtros e paginação<br>Retorna array de secretarias    | Retorna array não vazio<br>`paginate` chamado com os parâmetros corretos             |
| listar (sem resultados)            | Deve lançar erro 404 se não encontrar secretarias na paginação | `paginate` retorna array vazio<br>Lançamento de `CustomError`                           | Erro `CustomError` lançado                                                           |
| criar                              | Deve criar nova secretaria com dados fornecidos                | Instancia modelo com dados<br>Chama método `save`<br>Retorna secretaria criada          | Método construtor chamado com dados<br>`save` chamado<br>Retorna secretaria criada   |
| atualizar (existente)              | Deve atualizar secretaria existente pelo ID                    | Chamada ao método `findByIdAndUpdate` com ID e dados<br>Retorna secretaria atualizada   | Retorna secretaria atualizada<br>`findByIdAndUpdate` chamado com parâmetros corretos |
| atualizar (não existente)          | Deve lançar erro ao tentar atualizar secretaria inexistente    | `findByIdAndUpdate` retorna `null`<br>Lançamento de `CustomError`                       | Erro `CustomError` lançado                                                           |
| deletar                            | Deve deletar secretaria pelo ID                                | Chamada ao método `findByIdAndDelete` com ID<br>Retorna secretaria deletada             | Retorna secretaria deletada<br>`findByIdAndDelete` chamado com o ID correto          |

---